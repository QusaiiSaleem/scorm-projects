<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>التفكير الحاسوبي | محاضرة تفاعلية</title>

  <!-- Layered CSS: base -> theme -> decorations -->
  <link rel="stylesheet" href="../shared/base.css">
  <link rel="stylesheet" href="../shared/theme.css">
  <link rel="stylesheet" href="../shared/decorations.css">

  <style>
    /* ===== SCO 04: Interactive Lecture — Course-Specific Styles ===== */

    /* Points badge in header */
    .points-badge {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      padding: 4px 12px;
      border-radius: var(--radius-pill);
      font-family: var(--font-mono);
      font-size: var(--font-size-caption);
      font-weight: 700;
      color: var(--color-text-on-bright);
      background: var(--gradient-points);
      min-height: 32px;
    }

    .points-badge .pts-icon {
      font-size: 14px;
    }

    /* Points float animation */
    .points-float {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: var(--font-mono);
      font-size: 24px;
      font-weight: 700;
      color: var(--color-accent);
      pointer-events: none;
      z-index: 9999;
      animation: floatUp 1.2s ease-out forwards;
    }

    @keyframes floatUp {
      0%   { opacity: 1; transform: translate(-50%, -50%) scale(0.8); }
      40%  { opacity: 1; transform: translate(-50%, -80%) scale(1.1); }
      100% { opacity: 0; transform: translate(-50%, -120%) scale(0.9); }
    }

    /* Slide-specific layout helpers */
    .slide-title {
      font-size: var(--font-size-h1);
      margin-bottom: var(--space-lg);
      line-height: 1.3;
    }

    .slide-subtitle {
      font-family: var(--font-mono);
      font-size: var(--font-size-overline);
      font-weight: 700;
      letter-spacing: var(--letter-spacing-overline);
      text-transform: uppercase;
      color: var(--color-accent);
      margin-bottom: var(--space-sm);
    }

    .slide-body {
      font-size: var(--font-size-body-ar);
      line-height: var(--line-height-body-ar);
      color: var(--color-text);
    }

    .en-term {
      direction: ltr;
      unicode-bidi: isolate;
      font-family: var(--font-mono);
      color: var(--color-primary);
      font-size: 0.9em;
    }

    /* Code-style definition block */
    .definition-block {
      background: var(--color-background);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      margin: var(--space-lg) 0;
      font-family: var(--font-mono);
      position: relative;
    }

    .definition-block::before {
      content: '// definition';
      position: absolute;
      top: var(--space-sm);
      left: var(--space-md);
      font-size: var(--font-size-overline);
      color: var(--syntax-comment);
      font-family: var(--font-mono);
      direction: ltr;
    }

    .definition-block .def-text {
      font-family: var(--font-body-ar);
      font-size: var(--font-size-body-ar);
      line-height: var(--line-height-body-ar);
      color: var(--color-text);
      margin-top: var(--space-lg);
    }

    /* Pillar cards grid */
    .pillars-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-md);
      margin: var(--space-lg) 0;
    }

    @media (max-width: 600px) {
      .pillars-grid { grid-template-columns: 1fr; }
    }

    .pillar-card {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      text-align: center;
      transition: border-color var(--transition-base), box-shadow var(--transition-base);
    }

    .pillar-card:hover {
      border-color: var(--color-border-highlight);
    }

    .pillar-card .pillar-icon {
      font-size: 32px;
      margin-bottom: var(--space-sm);
      display: block;
    }

    .pillar-card .pillar-name {
      font-family: var(--font-heading-ar);
      font-weight: 700;
      font-size: var(--font-size-h3);
      margin-bottom: var(--space-xs);
    }

    .pillar-card .pillar-en {
      font-family: var(--font-mono);
      font-size: var(--font-size-caption);
      color: var(--color-text-muted);
      direction: ltr;
      margin-bottom: var(--space-sm);
    }

    .pillar-card .pillar-desc {
      font-size: var(--font-size-caption);
      color: var(--color-text-secondary);
      line-height: 1.6;
    }

    .pillar-card[data-accent="cyan"]  { border-top: 3px solid var(--syntax-keyword); }
    .pillar-card[data-accent="green"] { border-top: 3px solid var(--syntax-string); }
    .pillar-card[data-accent="orange"]{ border-top: 3px solid var(--syntax-function); }
    .pillar-card[data-accent="violet"]{ border-top: 3px solid var(--syntax-type); }

    /* Interactive example area */
    .example-area {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      margin: var(--space-lg) 0;
    }

    .example-area h3 {
      margin-bottom: var(--space-md);
      font-size: var(--font-size-h3);
    }

    /* Decomposition tree */
    .decomp-tree {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-md);
    }

    .decomp-node {
      background: var(--color-surface-elevated);
      border: 1px solid var(--color-border-highlight);
      border-radius: var(--radius-md);
      padding: var(--space-sm) var(--space-lg);
      font-family: var(--font-mono);
      font-size: var(--font-size-caption);
      color: var(--color-text);
      text-align: center;
      cursor: pointer;
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
      user-select: none;
    }

    .decomp-node:hover, .decomp-node:focus {
      border-color: var(--color-primary);
      box-shadow: var(--glow-primary);
    }

    .decomp-node.revealed {
      border-color: var(--color-success);
      box-shadow: var(--glow-accent);
    }

    .decomp-row {
      display: flex;
      gap: var(--space-md);
      flex-wrap: wrap;
      justify-content: center;
    }

    .decomp-connector {
      width: 2px;
      height: 20px;
      background: var(--color-border-highlight);
      margin: 0 auto;
    }

    /* Pattern highlights */
    .pattern-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--space-sm);
      margin: var(--space-lg) 0;
    }

    .pattern-item {
      background: var(--color-surface);
      border: 2px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--space-md);
      text-align: center;
      font-family: var(--font-mono);
      font-size: var(--font-size-h3);
      transition: border-color 0.3s ease, background 0.3s ease;
      cursor: pointer;
    }

    .pattern-item.highlighted {
      border-color: var(--color-accent);
      background: var(--color-success-bg);
    }

    .pattern-item .pattern-label {
      font-size: var(--font-size-caption);
      color: var(--color-text-secondary);
      margin-top: var(--space-xs);
      font-family: var(--font-body-ar);
    }

    /* Algorithm steps */
    .algo-steps {
      list-style: none;
      counter-reset: step;
      margin: var(--space-lg) 0;
    }

    .algo-steps li {
      counter-increment: step;
      display: flex;
      align-items: flex-start;
      gap: var(--space-md);
      padding: var(--space-md);
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-sm);
      font-size: var(--font-size-body-ar);
      line-height: var(--line-height-body-ar);
    }

    .algo-steps li::before {
      content: counter(step);
      flex-shrink: 0;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--color-surface-elevated);
      border: 1px solid var(--color-border-highlight);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-mono);
      font-size: var(--font-size-caption);
      font-weight: 700;
      color: var(--color-primary);
    }

    /* CT in Real Life examples */
    .reallife-cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-md);
      margin: var(--space-lg) 0;
    }

    @media (max-width: 600px) {
      .reallife-cards { grid-template-columns: 1fr; }
    }

    .reallife-card {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      transition: border-color var(--transition-base);
    }

    .reallife-card:hover { border-color: var(--color-border-highlight); }

    .reallife-card .rl-icon {
      font-size: 28px;
      margin-bottom: var(--space-sm);
    }

    .reallife-card h4 {
      font-size: var(--font-size-h4);
      margin-bottom: var(--space-sm);
    }

    .reallife-card p {
      font-size: var(--font-size-caption);
      color: var(--color-text-secondary);
      line-height: 1.7;
    }

    /* Summary recap cards */
    .recap-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-md);
      margin: var(--space-lg) 0;
    }

    @media (max-width: 600px) {
      .recap-grid { grid-template-columns: 1fr; }
    }

    .recap-card {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--space-md);
    }

    .recap-card .recap-icon {
      font-size: 24px;
      flex-shrink: 0;
    }

    .recap-card .recap-text {
      font-size: var(--font-size-caption);
      line-height: 1.6;
    }

    .recap-card .recap-text strong {
      display: block;
      font-size: var(--font-size-body-ar);
      margin-bottom: 2px;
    }

    /* Click-reveal within slides */
    .reveal-trigger {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      background: var(--color-surface);
      border: 1px solid var(--color-border-highlight);
      border-radius: var(--radius-md);
      padding: var(--space-sm) var(--space-md);
      cursor: pointer;
      font-size: var(--font-size-caption);
      font-family: var(--font-mono);
      color: var(--color-primary);
      transition: border-color var(--transition-fast), background var(--transition-fast);
      margin: var(--space-sm) 0;
    }

    .reveal-trigger:hover {
      border-color: var(--color-primary);
      background: rgba(34, 211, 238, 0.06);
    }

    .reveal-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.35s var(--ease-snappy), padding 0.2s ease;
      background: var(--color-surface-elevated);
      border-radius: var(--radius-md);
      border: 1px solid transparent;
    }

    .reveal-content.visible {
      max-height: 500px;
      padding: var(--space-md);
      border-color: var(--color-border);
      margin-top: var(--space-sm);
    }

    /* Flip card sets */
    .flip-cards-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--space-md);
      margin: var(--space-lg) 0;
    }

    @media (max-width: 700px) {
      .flip-cards-row { grid-template-columns: 1fr 1fr; }
    }

    .flip-card {
      perspective: 800px;
      height: 180px;
      cursor: pointer;
    }

    .flip-card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.5s var(--ease-spring);
      transform-style: preserve-3d;
    }

    .flip-card.flipped .flip-card-inner {
      transform: rotateY(180deg);
    }

    [dir="rtl"] .flip-card.flipped .flip-card-inner {
      transform: rotateY(-180deg);
    }

    .flip-card-front, .flip-card-back {
      position: absolute;
      inset: 0;
      backface-visibility: hidden;
      border-radius: var(--radius-md);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--space-md);
      text-align: center;
    }

    .flip-card-front {
      background: var(--gradient-flip);
      color: var(--color-text-on-bright);
    }

    .flip-card-front h4 {
      font-size: var(--font-size-h4);
      color: var(--color-text-on-bright);
      margin-bottom: var(--space-xs);
    }

    .flip-card-front .flip-hint {
      font-size: 11px;
      opacity: 0.7;
      position: absolute;
      bottom: 8px;
    }

    .flip-card-back {
      background: var(--color-surface-elevated);
      border: 1px solid var(--color-border-highlight);
      transform: rotateY(180deg);
    }

    [dir="rtl"] .flip-card-back {
      transform: rotateY(-180deg);
    }

    .flip-card-back p {
      font-size: var(--font-size-caption);
      color: var(--color-text-secondary);
      line-height: 1.6;
    }

    /* Tabs overrides for pillars */
    .pillar-tabs .tabs {
      background: var(--color-surface);
    }

    /* Abstraction layers visual */
    .abstraction-layers {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      margin: var(--space-lg) 0;
    }

    .abs-layer {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--space-md) var(--space-lg);
      display: flex;
      align-items: center;
      gap: var(--space-md);
      transition: opacity 0.3s ease, border-color 0.3s ease;
    }

    .abs-layer .layer-label {
      font-family: var(--font-mono);
      font-size: var(--font-size-caption);
      min-width: 100px;
      flex-shrink: 0;
    }

    .abs-layer.dimmed {
      opacity: 0.35;
      border-color: transparent;
    }

    .abs-layer.focused {
      border-color: var(--color-primary);
      box-shadow: var(--glow-primary);
    }

    /* Slide comment (like Storyline slide counter) */
    .slide-comment {
      font-family: var(--font-mono);
      font-size: var(--font-size-caption);
      color: var(--syntax-comment);
      direction: ltr;
      display: inline-block;
    }

    /* Completion overlay */
    .completion-overlay {
      position: fixed;
      inset: 0;
      background: var(--color-overlay);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .completion-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    .completion-card {
      background: var(--color-surface);
      border: 1px solid var(--color-success);
      border-radius: var(--radius-lg);
      padding: var(--space-2xl);
      text-align: center;
      max-width: 440px;
      box-shadow: var(--glow-accent);
    }

    .completion-card h2 {
      color: var(--color-success);
      margin-bottom: var(--space-md);
    }

    .completion-card .total-points {
      font-family: var(--font-mono);
      font-size: var(--font-size-display);
      font-weight: 700;
      color: var(--color-accent);
      margin: var(--space-md) 0;
    }

    .completion-card p {
      color: var(--color-text-secondary);
      font-size: var(--font-size-body-ar);
      line-height: var(--line-height-body-ar);
    }

    @media (prefers-reduced-motion: reduce) {
      .points-float { animation: none; display: none; }
    }
  </style>
</head>
<body>

  <!-- Skip Navigation -->
  <a href="#main-content" class="skip-nav">تخطي إلى المحتوى الرئيسي</a>

  <div class="sco-container">

    <!-- ============================================================
         HEADER: Progress bar + Points badge + Slide counter
         ============================================================ -->
    <header class="nav-bar" role="banner">
      <span class="course-title">التفكير الحاسوبي</span>
      <div class="progress-bar" style="flex: 1; margin: 0 var(--space-md); max-width: 280px;">
        <div class="progress-fill" id="progressBar" style="width: 0%;" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <div class="points-badge" id="pointsBadge" aria-label="النقاط المكتسبة">
        <span class="pts-icon" aria-hidden="true">&#9733;</span>
        <span id="pointsCount">0</span>
      </div>
    </header>

    <!-- ============================================================
         SLIDES CONTENT AREA
         ============================================================ -->
    <main class="sco-content" id="main-content" role="main">

      <!-- ==================== SLIDE 1: What is CT? ==================== -->
      <div class="slide" id="slide-1" data-slide="1" role="region" aria-label="الشريحة 1: ما هو التفكير الحاسوبي؟">
        <div class="slide-inner">
          <div class="slide-subtitle stagger-item">
            <span class="slide-comment">// slide 1 of 8</span>
          </div>
          <h1 class="slide-title stagger-item">ما هو التفكير الحاسوبي؟</h1>
          <p class="slide-body stagger-item">
            <strong>تخيل أنك تحتاج لتنظيم 10,000 كتاب في مكتبة. من أين تبدأ؟</strong>
          </p>
          <p class="slide-body stagger-item">
            التفكير الحاسوبي <span class="en-term">(Computational Thinking)</span> هو مجموعة من المهارات التي تساعدك على حل المشكلات المعقدة بطريقة منهجية — تمامًا كما يفعل الحاسوب، لكن بعقلك البشري.
          </p>

          <div class="definition-block stagger-item">
            <p class="def-text">
              <strong style="color: var(--color-primary);">التعريف:</strong>
              التفكير الحاسوبي هو عملية صياغة المشكلات بطريقة تسمح بحلها باستخدام خطوات حسابية وخوارزمية.
              <br><br>
              <span style="color: var(--syntax-comment); font-family: var(--font-mono); font-size: 0.85em;" dir="ltr">
                — Jeanette Wing, 2006
              </span>
            </p>
          </div>

          <div class="callout callout-info stagger-item">
            <span class="callout-icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-info)" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
            </span>
            <div>
              <p style="margin: 0;">
                التفكير الحاسوبي ليس مقتصرًا على المبرمجين — إنه مهارة حياتية يستخدمها الأطباء والمهندسون وحتى الطهاة!
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== SLIDE 2: The Four Pillars ==================== -->
      <div class="slide" id="slide-2" data-slide="2" role="region" aria-label="الشريحة 2: الأركان الأربعة">
        <div class="slide-inner align-top">
          <div class="slide-subtitle stagger-item">
            <span class="slide-comment">// slide 2 of 8</span>
          </div>
          <h1 class="slide-title stagger-item">الأركان الأربعة للتفكير الحاسوبي</h1>
          <p class="slide-body stagger-item">
            يرتكز التفكير الحاسوبي على أربعة أركان أساسية تعمل معًا لحل أي مشكلة:
          </p>

          <div class="pillars-grid">
            <div class="pillar-card stagger-item" data-accent="cyan">
              <span class="pillar-icon" aria-hidden="true">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--syntax-keyword)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
              </span>
              <div class="pillar-name">التجزئة</div>
              <div class="pillar-en">Decomposition</div>
              <div class="pillar-desc">تقسيم المشكلة الكبيرة إلى أجزاء صغيرة يمكن التعامل معها</div>
            </div>
            <div class="pillar-card stagger-item" data-accent="green">
              <span class="pillar-icon" aria-hidden="true">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--syntax-string)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><circle cx="12" cy="5" r="1.5"/><circle cx="12" cy="19" r="1.5"/><circle cx="5" cy="12" r="1.5"/><circle cx="19" cy="12" r="1.5"/></svg>
              </span>
              <div class="pillar-name">التعرف على الأنماط</div>
              <div class="pillar-en">Pattern Recognition</div>
              <div class="pillar-desc">إيجاد التشابهات والأنماط المتكررة بين المشكلات</div>
            </div>
            <div class="pillar-card stagger-item" data-accent="orange">
              <span class="pillar-icon" aria-hidden="true">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--syntax-function)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
              </span>
              <div class="pillar-name">التجريد</div>
              <div class="pillar-en">Abstraction</div>
              <div class="pillar-desc">التركيز على المعلومات المهمة وتجاهل التفاصيل غير الضرورية</div>
            </div>
            <div class="pillar-card stagger-item" data-accent="violet">
              <span class="pillar-icon" aria-hidden="true">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--syntax-type)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
              </span>
              <div class="pillar-name">التفكير الخوارزمي</div>
              <div class="pillar-en">Algorithmic Thinking</div>
              <div class="pillar-desc">تصميم حلول خطوة بخطوة بترتيب منطقي دقيق</div>
            </div>
          </div>

          <p class="slide-body stagger-item" style="color: var(--color-text-secondary); font-size: var(--font-size-caption); text-align: center; margin-top: var(--space-md);">
            انقر على بطاقات الشرائح القادمة لاستكشاف كل ركن بالتفصيل
          </p>
        </div>
      </div>

      <!-- ==================== SLIDE 3: Decomposition ==================== -->
      <div class="slide" id="slide-3" data-slide="3" role="region" aria-label="الشريحة 3: التجزئة">
        <div class="slide-inner align-top">
          <div class="slide-subtitle stagger-item">
            <span class="slide-comment">// slide 3 of 8 — Decomposition</span>
          </div>
          <h1 class="slide-title stagger-item">
            <span style="color: var(--syntax-keyword);">التجزئة</span>
            <span class="en-term" style="font-size: 0.7em;">(Decomposition)</span>
          </h1>
          <p class="slide-body stagger-item">
            التجزئة تعني تقسيم مشكلة كبيرة ومعقدة إلى أجزاء أصغر يسهل فهمها وحلها.
            بدلاً من محاولة حل كل شيء دفعة واحدة، نبدأ بأجزاء صغيرة.
          </p>

          <div class="example-area stagger-item">
            <h3>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--syntax-keyword)" stroke-width="2" style="display: inline; vertical-align: middle;" aria-hidden="true"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
              مثال تفاعلي: انقر لتجزئة المشكلة
            </h3>
            <div class="decomp-tree" id="decompTree">
              <div class="decomp-node revealed" style="border-color: var(--syntax-keyword);">
                تنظيم 10,000 كتاب في مكتبة
              </div>
              <div class="decomp-connector"></div>
              <div class="decomp-row" id="decompLevel1">
                <div class="decomp-node" tabindex="0" role="button" aria-label="انقر للكشف: تصنيف الكتب" onclick="revealNode(this)" onkeydown="if(event.key==='Enter')revealNode(this)">?</div>
                <div class="decomp-node" tabindex="0" role="button" aria-label="انقر للكشف: ترتيب الرفوف" onclick="revealNode(this)" onkeydown="if(event.key==='Enter')revealNode(this)">?</div>
                <div class="decomp-node" tabindex="0" role="button" aria-label="انقر للكشف: نظام الفهرسة" onclick="revealNode(this)" onkeydown="if(event.key==='Enter')revealNode(this)">?</div>
                <div class="decomp-node" tabindex="0" role="button" aria-label="انقر للكشف: نظام الإعارة" onclick="revealNode(this)" onkeydown="if(event.key==='Enter')revealNode(this)">?</div>
              </div>
            </div>
            <p style="text-align: center; color: var(--color-text-muted); font-size: var(--font-size-caption); margin-top: var(--space-md);">
              انقر على كل عقدة "؟" لكشف الجزء الفرعي
            </p>
          </div>
        </div>
      </div>

      <!-- ==================== SLIDE 4: Pattern Recognition ==================== -->
      <div class="slide" id="slide-4" data-slide="4" role="region" aria-label="الشريحة 4: التعرف على الأنماط">
        <div class="slide-inner align-top">
          <div class="slide-subtitle stagger-item">
            <span class="slide-comment">// slide 4 of 8 — Pattern Recognition</span>
          </div>
          <h1 class="slide-title stagger-item">
            <span style="color: var(--syntax-string);">التعرف على الأنماط</span>
            <span class="en-term" style="font-size: 0.7em;">(Pattern Recognition)</span>
          </h1>
          <p class="slide-body stagger-item">
            هل لاحظت أن جميع نماذج تسجيل الدخول تبدو متشابهة؟ حقل للبريد الإلكتروني، حقل لكلمة المرور، وزر "دخول".
            هذا هو التعرف على الأنماط — إيجاد التشابهات في المشكلات المختلفة.
          </p>

          <div class="example-area stagger-item">
            <h3>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--syntax-string)" stroke-width="2" style="display: inline; vertical-align: middle;" aria-hidden="true"><circle cx="12" cy="12" r="3"/><circle cx="12" cy="5" r="1.5"/><circle cx="12" cy="19" r="1.5"/></svg>
              اكتشف النمط: انقر على الأرقام التي تتبع نفس النمط
            </h3>
            <div class="pattern-grid" id="patternGrid">
              <div class="pattern-item" data-pattern="even" tabindex="0" role="button" onclick="togglePattern(this)" onkeydown="if(event.key==='Enter')togglePattern(this)">
                <span>2</span>
                <div class="pattern-label">عدد</div>
              </div>
              <div class="pattern-item" data-pattern="odd" tabindex="0" role="button" onclick="togglePattern(this)" onkeydown="if(event.key==='Enter')togglePattern(this)">
                <span>7</span>
                <div class="pattern-label">عدد</div>
              </div>
              <div class="pattern-item" data-pattern="even" tabindex="0" role="button" onclick="togglePattern(this)" onkeydown="if(event.key==='Enter')togglePattern(this)">
                <span>4</span>
                <div class="pattern-label">عدد</div>
              </div>
              <div class="pattern-item" data-pattern="odd" tabindex="0" role="button" onclick="togglePattern(this)" onkeydown="if(event.key==='Enter')togglePattern(this)">
                <span>9</span>
                <div class="pattern-label">عدد</div>
              </div>
              <div class="pattern-item" data-pattern="even" tabindex="0" role="button" onclick="togglePattern(this)" onkeydown="if(event.key==='Enter')togglePattern(this)">
                <span>6</span>
                <div class="pattern-label">عدد</div>
              </div>
              <div class="pattern-item" data-pattern="odd" tabindex="0" role="button" onclick="togglePattern(this)" onkeydown="if(event.key==='Enter')togglePattern(this)">
                <span>3</span>
                <div class="pattern-label">عدد</div>
              </div>
              <div class="pattern-item" data-pattern="even" tabindex="0" role="button" onclick="togglePattern(this)" onkeydown="if(event.key==='Enter')togglePattern(this)">
                <span>8</span>
                <div class="pattern-label">عدد</div>
              </div>
              <div class="pattern-item" data-pattern="odd" tabindex="0" role="button" onclick="togglePattern(this)" onkeydown="if(event.key==='Enter')togglePattern(this)">
                <span>5</span>
                <div class="pattern-label">عدد</div>
              </div>
            </div>
            <p id="patternFeedback" style="text-align: center; color: var(--color-text-muted); font-size: var(--font-size-caption); margin-top: var(--space-sm);">
              انقر على جميع الأعداد الزوجية لاكتشاف النمط
            </p>
          </div>
        </div>
      </div>

      <!-- ==================== SLIDE 5: Abstraction ==================== -->
      <div class="slide" id="slide-5" data-slide="5" role="region" aria-label="الشريحة 5: التجريد">
        <div class="slide-inner align-top">
          <div class="slide-subtitle stagger-item">
            <span class="slide-comment">// slide 5 of 8 — Abstraction</span>
          </div>
          <h1 class="slide-title stagger-item">
            <span style="color: var(--syntax-function);">التجريد</span>
            <span class="en-term" style="font-size: 0.7em;">(Abstraction)</span>
          </h1>
          <p class="slide-body stagger-item">
            التجريد يعني التركيز على ما هو مهم وتجاهل التفاصيل غير الضرورية.
            مثل خريطة المترو — لا تُظهر كل شارع، فقط المحطات والخطوط.
          </p>

          <div class="example-area stagger-item">
            <h3>انقر لإزالة التفاصيل غير المهمة:</h3>
            <p style="margin-bottom: var(--space-md); font-size: var(--font-size-caption); color: var(--color-text-secondary);">
              مثال: وصف طالب لنظام التسجيل الجامعي. ما المهم؟
            </p>
            <div class="abstraction-layers" id="absLayers">
              <div class="abs-layer" data-essential="true">
                <span class="layer-label" style="color: var(--color-success);" dir="ltr">essential</span>
                <span>اسم الطالب ورقمه الجامعي</span>
              </div>
              <div class="abs-layer" data-essential="false">
                <span class="layer-label" style="color: var(--color-text-muted);" dir="ltr">detail</span>
                <span>لون شعر الطالب</span>
                <button class="btn-ghost" style="margin-right: auto; font-size: 12px; padding: 4px 8px; min-height: auto;" onclick="dismissLayer(this)" aria-label="إزالة هذه التفصيلة">
                  حذف
                </button>
              </div>
              <div class="abs-layer" data-essential="true">
                <span class="layer-label" style="color: var(--color-success);" dir="ltr">essential</span>
                <span>المواد المسجلة والجدول الدراسي</span>
              </div>
              <div class="abs-layer" data-essential="false">
                <span class="layer-label" style="color: var(--color-text-muted);" dir="ltr">detail</span>
                <span>نوع الهاتف الذي يستخدمه الطالب</span>
                <button class="btn-ghost" style="margin-right: auto; font-size: 12px; padding: 4px 8px; min-height: auto;" onclick="dismissLayer(this)" aria-label="إزالة هذه التفصيلة">
                  حذف
                </button>
              </div>
              <div class="abs-layer" data-essential="true">
                <span class="layer-label" style="color: var(--color-success);" dir="ltr">essential</span>
                <span>الدرجات والمعدل التراكمي</span>
              </div>
              <div class="abs-layer" data-essential="false">
                <span class="layer-label" style="color: var(--color-text-muted);" dir="ltr">detail</span>
                <span>وجبة غداء الطالب المفضلة</span>
                <button class="btn-ghost" style="margin-right: auto; font-size: 12px; padding: 4px 8px; min-height: auto;" onclick="dismissLayer(this)" aria-label="إزالة هذه التفصيلة">
                  حذف
                </button>
              </div>
            </div>
            <p id="absFeedback" style="text-align: center; color: var(--color-text-muted); font-size: var(--font-size-caption); margin-top: var(--space-sm);">
              احذف التفاصيل غير الضرورية (3 عناصر)
            </p>
          </div>
        </div>
      </div>

      <!-- ==================== SLIDE 6: Algorithmic Thinking ==================== -->
      <div class="slide" id="slide-6" data-slide="6" role="region" aria-label="الشريحة 6: التفكير الخوارزمي">
        <div class="slide-inner align-top">
          <div class="slide-subtitle stagger-item">
            <span class="slide-comment">// slide 6 of 8 — Algorithmic Thinking</span>
          </div>
          <h1 class="slide-title stagger-item">
            <span style="color: var(--syntax-type);">التفكير الخوارزمي</span>
            <span class="en-term" style="font-size: 0.7em;">(Algorithmic Thinking)</span>
          </h1>
          <p class="slide-body stagger-item">
            الخوارزمية هي مجموعة من الخطوات المرتبة والدقيقة لحل مشكلة معينة.
            كل خطوة يجب أن تكون واضحة بحيث يمكن لأي شخص (أو حاسوب) تنفيذها.
          </p>

          <div class="example-area stagger-item">
            <h3>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--syntax-type)" stroke-width="2" style="display: inline; vertical-align: middle;" aria-hidden="true"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
              خوارزمية: كيف تصنع كوبًا من الشاي؟
            </h3>
            <ol class="algo-steps">
              <li class="stagger-item">املأ الغلاية بالماء</li>
              <li class="stagger-item">ضع الغلاية على النار</li>
              <li class="stagger-item">انتظر حتى يغلي الماء</li>
              <li class="stagger-item">ضع كيس الشاي في الكوب</li>
              <li class="stagger-item">اسكب الماء المغلي في الكوب</li>
              <li class="stagger-item">انتظر 3 دقائق</li>
              <li class="stagger-item">أزل كيس الشاي</li>
              <li class="stagger-item">أضف السكر أو الحليب حسب الرغبة</li>
            </ol>
          </div>

          <div class="callout callout-tip stagger-item">
            <span class="callout-icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-growth)" stroke-width="2"><path d="M12 2a7 7 0 017 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 01-1 1H9a1 1 0 01-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 017-7z"/><line x1="9" y1="21" x2="15" y2="21"/></svg>
            </span>
            <div>
              <p style="margin: 0;">
                <strong>تذكر:</strong> لو قدّمت الخطوة 5 قبل الخطوة 2، ستسكب ماءً باردًا! الترتيب في الخوارزمية مهم جدًا.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== SLIDE 7: CT in Real Life ==================== -->
      <div class="slide" id="slide-7" data-slide="7" role="region" aria-label="الشريحة 7: التفكير الحاسوبي في الحياة اليومية">
        <div class="slide-inner align-top">
          <div class="slide-subtitle stagger-item">
            <span class="slide-comment">// slide 7 of 8 — Real-World CT</span>
          </div>
          <h1 class="slide-title stagger-item">التفكير الحاسوبي في الحياة اليومية</h1>
          <p class="slide-body stagger-item">
            التفكير الحاسوبي ليس فقط للمبرمجين. إليك كيف تستخدمه يوميًا دون أن تدري:
          </p>

          <div class="reallife-cards">
            <div class="reallife-card stagger-item">
              <div class="rl-icon" aria-hidden="true">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--syntax-keyword)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
              </div>
              <h4>الطبخ</h4>
              <p>
                <strong>التجزئة:</strong> تقسيم الوصفة إلى مراحل (تحضير، طهي، تقديم).
                <strong>الخوارزمية:</strong> اتباع الخطوات بالترتيب.
                <strong>النمط:</strong> أغلب المعجنات تتبع نفس الأساسيات (دقيق + ماء + حرارة).
              </p>
            </div>
            <div class="reallife-card stagger-item">
              <div class="rl-icon" aria-hidden="true">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--syntax-string)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>
              </div>
              <h4>التخطيط للسفر</h4>
              <p>
                <strong>التجريد:</strong> التركيز على الوجهة والميزانية، لا لون الحقيبة.
                <strong>التجزئة:</strong> حجز الطيران + الفندق + الأنشطة.
                <strong>الاختيار:</strong> إن كان الطقس حارًا &rarr; ملابس صيفية.
              </p>
            </div>
            <div class="reallife-card stagger-item">
              <div class="rl-icon" aria-hidden="true">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--syntax-function)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
              </div>
              <h4>تصحيح الأخطاء</h4>
              <p>
                <strong>التجزئة:</strong> عزل الخطأ — أين بالضبط توقف البرنامج؟
                <strong>النمط:</strong> هل حدث هذا الخطأ من قبل؟
                <strong>التقييم:</strong> اختبار الإصلاح للتأكد من أنه يعمل.
              </p>
            </div>
          </div>

          <!-- Flip cards for each pillar -->
          <h3 class="stagger-item" style="margin-top: var(--space-xl);">اختبر معلوماتك — اقلب البطاقات:</h3>
          <div class="flip-cards-row">
            <div class="flip-card stagger-item" tabindex="0" role="button" aria-label="اقلب البطاقة: التجزئة"
                 onclick="this.classList.toggle('flipped')"
                 onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.classList.toggle('flipped')}">
              <div class="flip-card-inner">
                <div class="flip-card-front">
                  <h4>التجزئة</h4>
                  <span class="flip-hint">اقلب</span>
                </div>
                <div class="flip-card-back">
                  <p>تقسيم المشكلة إلى أجزاء صغيرة. مثال: تقسيم مشروع البرمجة إلى وحدات.</p>
                </div>
              </div>
            </div>
            <div class="flip-card stagger-item" tabindex="0" role="button" aria-label="اقلب البطاقة: الأنماط"
                 onclick="this.classList.toggle('flipped')"
                 onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.classList.toggle('flipped')}">
              <div class="flip-card-inner">
                <div class="flip-card-front">
                  <h4>الأنماط</h4>
                  <span class="flip-hint">اقلب</span>
                </div>
                <div class="flip-card-back">
                  <p>إيجاد التشابهات. مثال: كل حلقات for تحتوي متغير عداد وشرط إيقاف.</p>
                </div>
              </div>
            </div>
            <div class="flip-card stagger-item" tabindex="0" role="button" aria-label="اقلب البطاقة: التجريد"
                 onclick="this.classList.toggle('flipped')"
                 onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.classList.toggle('flipped')}">
              <div class="flip-card-inner">
                <div class="flip-card-front">
                  <h4>التجريد</h4>
                  <span class="flip-hint">اقلب</span>
                </div>
                <div class="flip-card-back">
                  <p>التركيز على المهم. مثال: خريطة المترو تُبسط الجغرافيا المعقدة.</p>
                </div>
              </div>
            </div>
            <div class="flip-card stagger-item" tabindex="0" role="button" aria-label="اقلب البطاقة: الخوارزمي"
                 onclick="this.classList.toggle('flipped')"
                 onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.classList.toggle('flipped')}">
              <div class="flip-card-inner">
                <div class="flip-card-front">
                  <h4>الخوارزمي</h4>
                  <span class="flip-hint">اقلب</span>
                </div>
                <div class="flip-card-back">
                  <p>خطوات مرتبة. مثال: وصفة الطبخ هي خوارزمية — الترتيب يهم!</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== SLIDE 8: Key Takeaways ==================== -->
      <div class="slide" id="slide-8" data-slide="8" role="region" aria-label="الشريحة 8: الخلاصة">
        <div class="slide-inner">
          <div class="slide-subtitle stagger-item">
            <span class="slide-comment">// slide 8 of 8 — Summary</span>
          </div>
          <h1 class="slide-title stagger-item">خلاصة المحاضرة</h1>
          <p class="slide-body stagger-item">
            تعلمت في هذه المحاضرة أساسيات التفكير الحاسوبي وأركانه الأربعة:
          </p>

          <div class="recap-grid">
            <div class="recap-card stagger-item">
              <span class="recap-icon" style="color: var(--syntax-keyword);" aria-hidden="true">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
              </span>
              <div class="recap-text">
                <strong>التجزئة</strong>
                قسّم المشكلة الكبيرة إلى أجزاء صغيرة
              </div>
            </div>
            <div class="recap-card stagger-item">
              <span class="recap-icon" style="color: var(--syntax-string);" aria-hidden="true">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><circle cx="12" cy="5" r="1.5"/><circle cx="12" cy="19" r="1.5"/></svg>
              </span>
              <div class="recap-text">
                <strong>الأنماط</strong>
                ابحث عن التشابهات والأنماط المتكررة
              </div>
            </div>
            <div class="recap-card stagger-item">
              <span class="recap-icon" style="color: var(--syntax-function);" aria-hidden="true">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
              </span>
              <div class="recap-text">
                <strong>التجريد</strong>
                ركّز على المهم وتجاهل التفاصيل
              </div>
            </div>
            <div class="recap-card stagger-item">
              <span class="recap-icon" style="color: var(--syntax-type);" aria-hidden="true">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
              </span>
              <div class="recap-text">
                <strong>الخوارزمي</strong>
                صمم حلولًا بخطوات مرتبة ودقيقة
              </div>
            </div>
          </div>

          <div class="callout callout-success stagger-item" style="margin-top: var(--space-xl);">
            <span class="callout-icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-success)" stroke-width="2"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
            </span>
            <div>
              <p style="margin: 0;">
                <strong>ممتاز!</strong> أنت الآن تعرف الأركان الأربعة. في الدروس القادمة ستطبق كل ركن عمليًا.
                <br>
                <span style="color: var(--color-text-muted); font-size: var(--font-size-caption);">
                  التالي: تحميل مرجع التفكير الحاسوبي (PDF) ثم مشاهدة فيديو التفكير المنطقي.
                </span>
              </p>
            </div>
          </div>
        </div>
      </div>

    </main>

    <!-- ============================================================
         NAVIGATION: Prev / Page Indicator / Next
         ============================================================ -->
    <nav class="sco-nav" role="navigation" aria-label="التنقل بين الشرائح">
      <button class="btn-prev" id="btnPrev" disabled aria-label="الشريحة السابقة">
        السابق
      </button>
      <span class="page-indicator" id="pageIndicator" dir="ltr">
        <span class="slide-comment">// slide</span> 1 / 8
      </span>
      <button class="btn-next" id="btnNext" aria-label="الشريحة التالية">
        التالي
      </button>
    </nav>

  </div>

  <!-- Completion Overlay -->
  <div class="completion-overlay" id="completionOverlay" role="dialog" aria-modal="true" aria-label="تم إكمال المحاضرة">
    <div class="completion-card">
      <h2>تم إكمال المحاضرة!</h2>
      <div class="total-points" id="finalPoints">0</div>
      <p>نقطة مكتسبة</p>
      <p style="margin-top: var(--space-md);">تعلمت أساسيات التفكير الحاسوبي وأركانه الأربعة. استمر في رحلتك التعليمية!</p>
      <button class="btn-primary" onclick="document.getElementById('completionOverlay').classList.remove('active')" style="margin-top: var(--space-lg);">
        إغلاق
      </button>
    </div>
  </div>

  <!-- SCORM API + Behavior Tracker + Gamification + Confetti -->
  <script src="../shared/scorm-api.js"></script>
  <script src="../shared/behavior-tracker.js"></script>
  <script src="../shared/gamification.js"></script>
  <script src="../shared/engine/confetti.js"></script>

  <script>
    (function() {
      'use strict';

      // -------------------------------------------------------
      // CONFIG
      // -------------------------------------------------------
      var TOTAL_SLIDES = 8;
      var POINTS_PER_SLIDE = 10;
      var currentSlide = 0; // 0-indexed
      var visitedSlides = {};
      var totalPoints = 0;
      var startTime = Date.now();

      // -------------------------------------------------------
      // SCORM
      // -------------------------------------------------------
      var scorm = new SCORMWrapper();
      scorm.initialize();

      // Check if already completed
      var currentStatus = scorm.getLessonStatus();
      var alreadyCompleted = (currentStatus === 'completed' || currentStatus === 'passed');

      // -------------------------------------------------------
      // Behavior Tracker
      // -------------------------------------------------------
      var tracker;
      try {
        tracker = new BehaviorTracker(scorm);
        tracker.startSession();
      } catch(e) {
        console.warn('BehaviorTracker not available:', e);
      }

      // -------------------------------------------------------
      // Gamification (simple in-page implementation)
      // -------------------------------------------------------
      var confettiEngine;
      try {
        confettiEngine = new Confetti();
      } catch(e) {
        console.warn('Confetti not available:', e);
      }

      // -------------------------------------------------------
      // Resume from bookmark
      // -------------------------------------------------------
      try {
        var bookmark = scorm.getBookmark();
        if (bookmark) {
          var data = JSON.parse(bookmark);
          if (data.currentSlide !== undefined) {
            currentSlide = Math.min(data.currentSlide, TOTAL_SLIDES - 1);
          }
          if (data.visitedSlides) {
            visitedSlides = data.visitedSlides;
          }
          if (data.totalPoints !== undefined) {
            totalPoints = data.totalPoints;
          }
        }
      } catch(e) {
        // Ignore parse errors — start fresh
      }

      // -------------------------------------------------------
      // SLIDE NAVIGATION
      // -------------------------------------------------------
      function showSlide(index) {
        // Bounds check
        if (index < 0 || index >= TOTAL_SLIDES) return;

        // Hide current slide
        var allSlides = document.querySelectorAll('.slide');
        allSlides.forEach(function(s) {
          s.classList.remove('active', 'animate-in');
        });

        // Show target slide
        var targetSlide = document.getElementById('slide-' + (index + 1));
        if (!targetSlide) return;

        targetSlide.classList.add('active', 'animate-in');
        currentSlide = index;

        // Track visit
        if (!visitedSlides[index]) {
          visitedSlides[index] = true;
          awardPoints(POINTS_PER_SLIDE);

          // Track with behavior tracker
          if (tracker) {
            try { tracker.trackPageView('sco_04_slide_' + (index + 1)); } catch(e) {}
          }
        }

        // Update UI
        updateNavigation();
        updateProgress();

        // Re-trigger stagger animations on the new slide
        var staggerItems = targetSlide.querySelectorAll('.stagger-item');
        staggerItems.forEach(function(item, i) {
          item.style.animation = 'none';
          item.offsetHeight; // Force reflow
          item.style.animation = '';
        });

        // Check completion
        checkCompletion();
      }

      function updateNavigation() {
        var prevBtn = document.getElementById('btnPrev');
        var nextBtn = document.getElementById('btnNext');
        var indicator = document.getElementById('pageIndicator');

        prevBtn.disabled = (currentSlide === 0);

        if (currentSlide === TOTAL_SLIDES - 1) {
          nextBtn.textContent = 'إنهاء';
          nextBtn.onclick = function() { triggerCompletion(); };
        } else {
          nextBtn.textContent = 'التالي';
          nextBtn.onclick = function() { showSlide(currentSlide + 1); };
        }

        indicator.innerHTML = '<span class="slide-comment">// slide</span> ' + (currentSlide + 1) + ' / ' + TOTAL_SLIDES;
      }

      function updateProgress() {
        var visitedCount = Object.keys(visitedSlides).length;
        var pct = (visitedCount / TOTAL_SLIDES) * 100;
        var progressBar = document.getElementById('progressBar');
        if (progressBar) {
          progressBar.style.width = pct + '%';
          progressBar.setAttribute('aria-valuenow', Math.round(pct));
        }
      }

      function awardPoints(pts) {
        totalPoints += pts;
        document.getElementById('pointsCount').textContent = totalPoints;

        // Float animation
        showPointsFloat('+' + pts);
      }

      function showPointsFloat(text) {
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
        var el = document.createElement('div');
        el.className = 'points-float';
        el.textContent = text;
        document.body.appendChild(el);
        setTimeout(function() { el.remove(); }, 1300);
      }

      function checkCompletion() {
        var visitedCount = Object.keys(visitedSlides).length;
        if (visitedCount >= TOTAL_SLIDES && !alreadyCompleted) {
          // All slides visited — mark complete
          scorm.setLessonStatus('completed');
          scorm.commit();
          alreadyCompleted = true;
        }
      }

      function triggerCompletion() {
        // Make sure all slides are counted
        if (!visitedSlides[currentSlide]) {
          visitedSlides[currentSlide] = true;
          awardPoints(POINTS_PER_SLIDE);
        }

        checkCompletion();

        // Show celebration
        document.getElementById('finalPoints').textContent = totalPoints;
        document.getElementById('completionOverlay').classList.add('active');

        if (confettiEngine) {
          try { confettiEngine.fire(); } catch(e) {}
        }
      }

      // -------------------------------------------------------
      // BUTTON EVENT LISTENERS
      // -------------------------------------------------------
      document.getElementById('btnPrev').addEventListener('click', function() {
        if (currentSlide > 0) {
          showSlide(currentSlide - 1);
        }
      });

      document.getElementById('btnNext').addEventListener('click', function() {
        if (currentSlide < TOTAL_SLIDES - 1) {
          showSlide(currentSlide + 1);
        }
      });

      // Keyboard navigation
      document.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowLeft') {
          // In RTL, left arrow = next
          if (currentSlide < TOTAL_SLIDES - 1) showSlide(currentSlide + 1);
        } else if (e.key === 'ArrowRight') {
          // In RTL, right arrow = prev
          if (currentSlide > 0) showSlide(currentSlide - 1);
        }
      });

      // -------------------------------------------------------
      // SAVE STATE ON UNLOAD
      // -------------------------------------------------------
      window.addEventListener('beforeunload', function() {
        var elapsed = Math.floor((Date.now() - startTime) / 1000);
        scorm.setSessionTime(elapsed);

        try {
          var suspendData = JSON.stringify({
            currentSlide: currentSlide,
            visitedSlides: visitedSlides,
            totalPoints: totalPoints
          });
          scorm.setBookmark(suspendData);
        } catch(e) {}

        scorm.commit();
      });

      // -------------------------------------------------------
      // INITIALIZE: Show the first (or resumed) slide
      // -------------------------------------------------------
      // Update points display from saved state
      document.getElementById('pointsCount').textContent = totalPoints;

      // Show initial slide
      showSlide(currentSlide);

    })();

    // -------------------------------------------------------
    // INTERACTIVE COMPONENTS (global scope for onclick handlers)
    // -------------------------------------------------------

    // Decomposition Tree (Slide 3)
    var decompLabels = ['تصنيف الكتب حسب الموضوع', 'ترتيب الرفوف أبجديًا', 'إنشاء نظام فهرسة', 'نظام الإعارة والإرجاع'];
    var decompRevealed = 0;

    function revealNode(node) {
      if (node.classList.contains('revealed')) return;
      node.textContent = decompLabels[decompRevealed];
      node.classList.add('revealed');
      decompRevealed++;
    }

    // Pattern Recognition (Slide 4)
    function togglePattern(item) {
      item.classList.toggle('highlighted');
      checkPatternCompletion();
    }

    function checkPatternCompletion() {
      var grid = document.getElementById('patternGrid');
      var items = grid.querySelectorAll('.pattern-item');
      var allEvenHighlighted = true;
      var anyOddHighlighted = false;

      items.forEach(function(item) {
        if (item.dataset.pattern === 'even' && !item.classList.contains('highlighted')) {
          allEvenHighlighted = false;
        }
        if (item.dataset.pattern === 'odd' && item.classList.contains('highlighted')) {
          anyOddHighlighted = true;
        }
      });

      var feedback = document.getElementById('patternFeedback');
      if (allEvenHighlighted && !anyOddHighlighted) {
        feedback.textContent = 'ممتاز! اكتشفت النمط — جميع الأعداد الزوجية قابلة للقسمة على 2.';
        feedback.style.color = 'var(--color-success)';
      } else if (anyOddHighlighted) {
        feedback.textContent = 'تلميح: الأعداد الفردية ليست جزءًا من هذا النمط. حاول مرة أخرى!';
        feedback.style.color = 'var(--color-warning)';
      }
    }

    // Abstraction Layers (Slide 5)
    var dismissedCount = 0;
    function dismissLayer(btn) {
      var layer = btn.closest('.abs-layer');
      layer.classList.add('dimmed');
      layer.style.textDecoration = 'line-through';
      btn.disabled = true;
      btn.style.opacity = '0.3';
      dismissedCount++;

      var feedback = document.getElementById('absFeedback');
      if (dismissedCount >= 3) {
        feedback.textContent = 'ممتاز! أزلت كل التفاصيل غير الضرورية. هذا هو التجريد!';
        feedback.style.color = 'var(--color-success)';

        // Highlight essential layers
        var essentialLayers = document.querySelectorAll('.abs-layer[data-essential="true"]');
        essentialLayers.forEach(function(l) { l.classList.add('focused'); });
      } else {
        feedback.textContent = 'أزلت ' + dismissedCount + ' من 3 تفاصيل غير ضرورية';
      }
    }

  </script>

</body>
</html>
