<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>من الفكرة إلى السوق | الذهنية الرقمية وممارسات الابتكار التقني</title>
  <link rel="stylesheet" href="../shared/base.css">
  <link rel="stylesheet" href="../shared/theme.css">
  <link rel="stylesheet" href="../shared/course-custom.css">
</head>
<body>
  <a href="#main-content" class="skip-nav">تخطي إلى المحتوى الرئيسي</a>

  <div class="sco-container">
    <header class="nav-bar">
      <span class="course-title">الوحدة 3: من الفكرة إلى السوق</span>
      <div class="points-badge elastic-click" id="pointsBadge" aria-label="النقاط">
        <span>&#11088;</span>
        <span class="points-count" id="pointsDisplay">0</span>
      </div>
    </header>
    <div class="progress-bar" role="progressbar"><div class="progress-fill" id="progressFill"></div></div>

    <main class="sco-content" id="main-content">

      <!-- Slide 0: Hero -->
      <div class="slide" data-slide="0">
        <div class="slide-inner">
          <div class="hero-section has-grain text-center stagger-item">
            <p style="font-size:var(--font-size-small); opacity:0.9;">الوحدة الثالثة</p>
            <h1 class="display-text" style="color:white;">من الفكرة إلى السوق</h1>
            <p style="color:rgba(255,255,255,0.9);">70% من المنتجات الرقمية تفشل... ما السر؟</p>
          </div>
          <div class="callout callout-tip stagger-item" style="max-width:700px; margin:12px auto 0;">
            <span class="callout-icon" aria-hidden="true">&#127919;</span>
            <div><strong>أهداف:</strong> ملاءمة التكنولوجيا للسوق &bull; أنواع النماذج الأولية &bull; اختبار <span class="ltr-inline">A/B</span> &bull; العقلية الريادية</div>
          </div>
        </div>
      </div>

      <!-- Slide 1: Tech-Market Fit -->
      <div class="slide" data-slide="1">
        <div class="slide-inner align-top">
          <h2 class="stagger-item">ملاءمة التكنولوجيا للسوق <span class="ltr-inline">(Technology-Market Fit)</span></h2>
          <p class="stagger-item">التكنولوجيا وحدها لا تكفي — يجب أن <strong>تتوافق مع احتياجات المستخدم الفعلية</strong>.</p>

          <div class="accordion stagger-item" style="margin-top:16px;">
            <div class="accordion-item">
              <button class="accordion-header" aria-expanded="false" onclick="toggleAccordion(this)">
                <span>&#128269; بحث السوق</span>
                <span class="chevron" aria-hidden="true">&#9660;</span>
              </button>
              <div class="accordion-body" role="region">
                <p>دراسة السوق المستهدف: من هم المستخدمون؟ ما مشكلاتهم؟ ما الحلول المتاحة حاليًا؟ استخدم الاستطلاعات والمقابلات لجمع البيانات.</p>
              </div>
            </div>
            <div class="accordion-item">
              <button class="accordion-header" aria-expanded="false" onclick="toggleAccordion(this)">
                <span>&#128202; تحليل المنافسة</span>
                <span class="chevron" aria-hidden="true">&#9660;</span>
              </button>
              <div class="accordion-body" role="region">
                <p>ادرس المنافسين: ما نقاط قوتهم وضعفهم؟ كيف يمكنك تقديم قيمة مضافة مختلفة؟ لا تنسخ — ابتكر!</p>
              </div>
            </div>
            <div class="accordion-item">
              <button class="accordion-header" aria-expanded="false" onclick="toggleAccordion(this)">
                <span>&#128172; التغذية الراجعة من العملاء</span>
                <span class="chevron" aria-hidden="true">&#9660;</span>
              </button>
              <div class="accordion-body" role="region">
                <p>استمع لعملائك باستمرار. التغذية الراجعة <span class="ltr-inline">(Feedback)</span> هي البوصلة التي توجهك نحو ملاءمة السوق.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Slide 2: Case studies (Click reveal) -->
      <div class="slide" data-slide="2">
        <div class="slide-inner align-top">
          <h2 class="stagger-item">دراسة حالة: نجاح مقابل فشل</h2>
          <div style="display:grid; gap:12px; margin-top:12px;">
            <div class="reveal-trigger stagger-item" onclick="toggleReveal(this)" role="button" tabindex="0" aria-expanded="false"
                 onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleReveal(this)}">
              <span class="hint-text">&#10004; تطبيق ناجح: حقق ملاءمة السوق</span>
            </div>
            <div class="reveal-content">
              <div class="card shadow-sm" style="border-right:4px solid var(--color-success);">
                <p><strong>المشكلة:</strong> طلاب الجامعة يعانون من صعوبة حجز مواعيد العيادة.</p>
                <p><strong>الحل:</strong> تطبيق حجز بسيط بخطوة واحدة مع تنبيهات.</p>
                <p><strong>لماذا نجح:</strong> ركّز على المشكلة الأكبر (78% يعانون) + استخدم الطريقة المفضلة (65% يريدون الجوال) = <strong>ملاءمة سوق قوية</strong>.</p>
              </div>
            </div>

            <div class="reveal-trigger stagger-item" onclick="toggleReveal(this)" role="button" tabindex="0" aria-expanded="false"
                 onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleReveal(this)}">
              <span class="hint-text">&#10008; تطبيق فاشل: تقنية متقدمة بدون ملاءمة</span>
            </div>
            <div class="reveal-content">
              <div class="card shadow-sm" style="border-right:4px solid var(--color-error);">
                <p><strong>التقنية:</strong> ذكاء اصطناعي متقدم لتحليل أنماط الدراسة.</p>
                <p><strong>المشكلة:</strong> لم يبحث عن احتياجات الطلاب الحقيقية — بنى ما يعتقد أنهم يريدونه.</p>
                <p><strong>لماذا فشل:</strong> تقنية رائعة لكن <strong>لا أحد يحتاجها</strong> — ضعف ملاءمة السوق.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Slide 3: KC - Market Fit -->
      <div class="slide" data-slide="3">
        <div class="slide-inner">
          <div class="quiz-container">
            <p class="quiz-progress">فحص المعرفة</p>
            <h3 class="question-stem stagger-item">لماذا تفشل معظم المنتجات الرقمية رغم جودتها التقنية؟</h3>
            <div id="kc1-options">
              <button class="btn-quiz-option elastic-click stagger-item" data-id="a" onclick="answerKC('kc1',this,'a')">بسبب ضعف التسويق فقط</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="b" onclick="answerKC('kc1',this,'b')">لأنها لا تلبي احتياجات المستخدمين الفعلية — ضعف ملاءمة السوق</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="c" onclick="answerKC('kc1',this,'c')">لأن المنافسة دائمًا أقوى</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="d" onclick="answerKC('kc1',this,'d')">لأن التكنولوجيا تتغير بسرعة</button>
            </div>
            <div id="kc1-feedback" class="hidden" style="margin-top:16px;"></div>
          </div>
        </div>
      </div>

      <!-- Slide 4: Prototype Types (Flip cards) -->
      <div class="slide" data-slide="4">
        <div class="slide-inner align-top">
          <h2 class="stagger-item">أنواع النماذج الأولية <span class="ltr-inline">(Prototypes)</span></h2>
          <p class="stagger-item">اضغط كل بطاقة لمعرفة التفاصيل:</p>

          <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:16px; margin-top:16px;">
            <div class="flip-card hover-lift stagger-item" style="height:200px;" onclick="this.classList.toggle('flipped')" role="button" tabindex="0"
                 onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.classList.toggle('flipped')}">
              <div class="flip-card-inner">
                <div class="flip-card-front" style="padding:16px;">
                  <span style="font-size:2.5rem;">&#128196;</span>
                  <h4 style="color:white; margin:8px 0 0;">نموذج ورقي</h4>
                  <p class="text-small ltr-inline" style="color:rgba(255,255,255,0.8);">Paper Prototype</p>
                </div>
                <div class="flip-card-back" style="padding:14px; text-align:right; font-size:14px;">
                  <p><strong>ما هو:</strong> رسومات تخطيطية على ورق.</p>
                  <p><strong>متى:</strong> المراحل الأولى — اختبار سريع وبأقل تكلفة.</p>
                  <p><strong>الميزة:</strong> الأسرع والأرخص — يمكن تعديله فورًا.</p>
                </div>
              </div>
            </div>

            <div class="flip-card hover-lift stagger-item" style="height:200px;" onclick="this.classList.toggle('flipped')" role="button" tabindex="0"
                 onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.classList.toggle('flipped')}">
              <div class="flip-card-inner">
                <div class="flip-card-front" style="padding:16px;">
                  <span style="font-size:2.5rem;">&#128187;</span>
                  <h4 style="color:white; margin:8px 0 0;">نموذج رقمي</h4>
                  <p class="text-small ltr-inline" style="color:rgba(255,255,255,0.8);">Digital Prototype</p>
                </div>
                <div class="flip-card-back" style="padding:14px; text-align:right; font-size:14px;">
                  <p><strong>ما هو:</strong> نماذج برمجية تفاعلية.</p>
                  <p><strong>متى:</strong> بعد التحقق من الفكرة بالنموذج الورقي.</p>
                  <p><strong>الميزة:</strong> يشبه المنتج النهائي ويوفر تجربة واقعية.</p>
                </div>
              </div>
            </div>

            <div class="flip-card hover-lift stagger-item" style="height:200px;" onclick="this.classList.toggle('flipped')" role="button" tabindex="0"
                 onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.classList.toggle('flipped')}">
              <div class="flip-card-inner">
                <div class="flip-card-front" style="padding:16px;">
                  <span style="font-size:2.5rem;">&#128230;</span>
                  <h4 style="color:white; margin:8px 0 0;">نموذج مادي</h4>
                  <p class="text-small ltr-inline" style="color:rgba(255,255,255,0.8);">Physical Prototype</p>
                </div>
                <div class="flip-card-back" style="padding:14px; text-align:right; font-size:14px;">
                  <p><strong>ما هو:</strong> نماذج منتجات أولية فعلية.</p>
                  <p><strong>متى:</strong> المنتجات المادية — أجهزة، أدوات.</p>
                  <p><strong>الميزة:</strong> اختبار حقيقي للمنتج في الواقع.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Slide 5: Iteration + A/B Testing (Timeline) -->
      <div class="slide" data-slide="5">
        <div class="slide-inner align-top">
          <h2 class="stagger-item">العملية التكرارية واختبار <span class="ltr-inline">A/B</span></h2>
          <div class="timeline stagger-item">
            <div class="timeline-item">
              <div class="timeline-content"><strong>1. بناء <span class="ltr-inline">(Build)</span>:</strong> ابنِ نموذجًا أوليًا بسيطًا — لا تسعى للكمال.</div>
            </div>
            <div class="timeline-item">
              <div class="timeline-content"><strong>2. اختبار <span class="ltr-inline">(Test)</span>:</strong> اختبره مع مستخدمين حقيقيين واجمع ملاحظاتهم.</div>
            </div>
            <div class="timeline-item">
              <div class="timeline-content"><strong>3. صقل <span class="ltr-inline">(Refine)</span>:</strong> حسّن بناءً على التغذية الراجعة — ما الذي عمل وما الذي لم يعمل؟</div>
            </div>
            <div class="timeline-item">
              <div class="timeline-content"><strong>4. تكرار <span class="ltr-inline">(Repeat)</span>:</strong> أعد الدورة حتى تصل لمنتج يلبي الاحتياجات.</div>
            </div>
          </div>
          <div class="callout callout-info stagger-item" style="margin-top:12px;">
            <span class="callout-icon" aria-hidden="true">&#128161;</span>
            <div><strong>اختبار <span class="ltr-inline">A/B</span>:</strong> قارن نسختين مختلفتين (مثلاً: واجهة بسيطة مقابل واجهة تفصيلية) لتعرف أيهما أفضل بناءً على بيانات فعلية وليس افتراضات.</div>
          </div>
        </div>
      </div>

      <!-- Slide 6: KC - Prototype -->
      <div class="slide" data-slide="6">
        <div class="slide-inner">
          <div class="quiz-container">
            <p class="quiz-progress">فحص المعرفة</p>
            <h3 class="question-stem stagger-item">يريد مصمم اختبار فكرة تطبيق جوال بسرعة وبأقل تكلفة. أي نوع نموذج أولي هو الأنسب؟</h3>
            <div id="kc2-options">
              <button class="btn-quiz-option elastic-click stagger-item" data-id="a" onclick="answerKC('kc2',this,'a')">نموذج مادي — بناء جهاز فعلي</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="b" onclick="answerKC('kc2',this,'b')">نموذج ورقي — رسومات تخطيطية للشاشات</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="c" onclick="answerKC('kc2',this,'c')">تطبيق مبرمج بالكامل جاهز للنشر</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="d" onclick="answerKC('kc2',this,'d')">لا يحتاج نموذجًا — يبدأ البرمجة مباشرة</button>
            </div>
            <div id="kc2-feedback" class="hidden" style="margin-top:16px;"></div>
          </div>
        </div>
      </div>

      <!-- Slide 7: Entrepreneurial Mindset -->
      <div class="slide" data-slide="7">
        <div class="slide-inner align-top">
          <h2 class="stagger-item">بناء عقلية ريادية</h2>
          <div style="display:grid; grid-template-columns:repeat(2, 1fr); gap:16px; margin-top:16px;">
            <div class="card shadow-sm hover-lift stagger-item">
              <h4>&#128170; الفشل = فرصة للتعلم</h4>
              <p>كل محاولة فاشلة تعلمك شيئًا جديدًا. رواد الأعمال الناجحون فشلوا عدة مرات قبل النجاح.</p>
            </div>
            <div class="card shadow-sm hover-lift stagger-item">
              <h4>&#128066; الانفتاح على التغذية الراجعة</h4>
              <p>لا فكرة مثالية من البداية. استمع للآخرين وعدّل خطتك بناءً على ملاحظاتهم.</p>
            </div>
            <div class="card shadow-sm hover-lift stagger-item">
              <h4>&#128161; الفضول والتحسين المستمر</h4>
              <p>لا تتوقف عن التعلم. السوق يتغير باستمرار ومن يتعلم أسرع ينجح.</p>
            </div>
            <div class="card shadow-sm hover-lift stagger-item">
              <h4>&#129309; التعاون وبناء العلاقات</h4>
              <p>انضم لحاضنات الأعمال، احضر الفعاليات، واستفد من خبرات الآخرين.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Slide 8: Lean Startup + BMC (Tabs) -->
      <div class="slide" data-slide="8">
        <div class="slide-inner align-top">
          <h2 class="stagger-item">أدوات رائد الأعمال</h2>
          <div class="tabs-container stagger-item" style="margin-top:12px;">
            <div class="tabs" role="tablist">
              <button class="tab active" role="tab" aria-selected="true" aria-controls="tool-1" id="tool-t1" onclick="switchTab(this,'tool-1')">الشركات الناشئة المرنة</button>
              <button class="tab" role="tab" aria-selected="false" aria-controls="tool-2" id="tool-t2" onclick="switchTab(this,'tool-2')">نموذج العمل التجاري</button>
            </div>
            <div class="tab-content active" role="tabpanel" id="tool-1" aria-labelledby="tool-t1">
              <div class="card shadow-sm">
                <h4>&#128640; <span class="ltr-inline">Lean Startup</span> — الشركات الناشئة المرنة</h4>
                <p>منهجية تعتمد على التطوير السريع التكراري:</p>
                <div style="display:flex; gap:8px; align-items:center; justify-content:center; margin:16px 0; font-weight:600; font-size:1.1rem;">
                  <span class="card shadow-sm" style="padding:8px 16px;">بناء <span class="ltr-inline">Build</span></span>
                  <span>&#8594;</span>
                  <span class="card shadow-sm" style="padding:8px 16px;">قياس <span class="ltr-inline">Measure</span></span>
                  <span>&#8594;</span>
                  <span class="card shadow-sm" style="padding:8px 16px;">تعلم <span class="ltr-inline">Learn</span></span>
                </div>
                <p class="text-secondary">ابدأ بنسخة بسيطة، اختبرها، تعلم من النتائج، ثم حسّن. لا تنتظر الكمال!</p>
              </div>
            </div>
            <div class="tab-content" role="tabpanel" id="tool-2" aria-labelledby="tool-t2">
              <div class="card shadow-sm">
                <h4>&#128203; <span class="ltr-inline">Business Model Canvas</span> — نموذج العمل التجاري</h4>
                <p>أداة من 9 مكونات لهيكلة فكرتك التجارية في صفحة واحدة:</p>
                <ul style="margin-top:8px; font-size:15px;">
                  <li>شرائح العملاء — القيمة المقترحة — القنوات</li>
                  <li>العلاقة مع العملاء — مصادر الإيرادات</li>
                  <li>الموارد الرئيسية — الأنشطة الرئيسية — الشراكات</li>
                  <li>هيكل التكاليف</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Slide 9: Overcoming Challenges -->
      <div class="slide" data-slide="9">
        <div class="slide-inner align-top">
          <h2 class="stagger-item">التغلب على تحديات الابتكار</h2>
          <div style="display:grid; gap:16px; margin-top:16px;">
            <div class="callout callout-warning stagger-item">
              <span class="callout-icon" aria-hidden="true">&#9888;</span>
              <div>
                <strong>التحدي: مقاومة التغيير</strong>
                <p style="margin-top:4px;"><strong>الحل:</strong> تشجيع التجربة في بيئة آمنة — اسمح بالأخطاء دون عقاب.</p>
              </div>
            </div>
            <div class="callout callout-warning stagger-item">
              <span class="callout-icon" aria-hidden="true">&#9888;</span>
              <div>
                <strong>التحدي: الخوف من الفشل</strong>
                <p style="margin-top:4px;"><strong>الحل:</strong> تعزيز ثقافة الانفتاح والتواصل المفتوح — الفشل خطوة نحو النجاح.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Slide 10: KC - Tools -->
      <div class="slide" data-slide="10">
        <div class="slide-inner">
          <div class="quiz-container">
            <p class="quiz-progress">فحص المعرفة</p>
            <h3 class="question-stem stagger-item">منهجية الشركات الناشئة المرنة <span class="ltr-inline">(Lean Startup)</span> تعتمد على تطوير المنتج بالكامل أولًا ثم إطلاقه دفعة واحدة.</h3>
            <div id="kc3-options">
              <button class="btn-quiz-option elastic-click stagger-item" data-id="true" onclick="answerKC('kc3',this,'true')">صحيح</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="false" onclick="answerKC('kc3',this,'false')">خطأ</button>
            </div>
            <div id="kc3-feedback" class="hidden" style="margin-top:16px;"></div>
          </div>
        </div>
      </div>

      <!-- Slide 11: Course Summary -->
      <div class="slide" data-slide="11">
        <div class="slide-inner">
          <h2 class="text-center stagger-item">ملخص شامل: الرحلة كاملة</h2>
          <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:16px; margin-top:20px;">
            <div class="card shadow-sm stagger-item" style="border-right:4px solid var(--color-primary);">
              <h4>الوحدة 1</h4>
              <p class="text-small">الابتكار + العصف الذهني + <span class="ltr-inline">SCAMPER</span> + ريادة الأعمال</p>
            </div>
            <div class="card shadow-sm stagger-item" style="border-right:4px solid var(--color-secondary);">
              <h4>الوحدة 2</h4>
              <p class="text-small">التفكير التصميمي (5 مراحل) + المرونة والتكيف</p>
            </div>
            <div class="card shadow-sm stagger-item" style="border-right:4px solid var(--color-accent);">
              <h4>الوحدة 3</h4>
              <p class="text-small">ملاءمة السوق + النماذج الأولية + <span class="ltr-inline">Lean Startup</span> + العقلية الريادية</p>
            </div>
          </div>
          <div class="callout callout-success stagger-item" style="margin-top:20px; max-width:600px; margin-left:auto; margin-right:auto;">
            <span class="callout-icon" aria-hidden="true">&#127881;</span>
            <div><strong>أتممت جميع الوحدات الثلاث (100%)!</strong> الآن حان وقت تطبيق ما تعلمته في الأنشطة التفاعلية.</div>
          </div>
        </div>
      </div>

    </main>

    <nav class="sco-nav" aria-label="تنقل الدرس">
      <button class="btn-prev elastic-click" id="prevBtn" disabled>السابق</button>
      <span class="page-indicator" id="pageIndicator">1 / 12</span>
      <button class="btn-next elastic-click" id="nextBtn" data-next-text="التالي" data-complete-text="إكمال الوحدة">التالي</button>
    </nav>
  </div>

  <script src="../shared/scorm-api.js"></script>
  <script src="../shared/engine/slide-controller.js"></script>
  <script src="../shared/engine/sound-effects.js"></script>
  <script src="../shared/engine/confetti.js"></script>
  <script src="../shared/behavior-tracker.js"></script>
  <script src="../shared/gamification.js"></script>

  <script>
  (function() {
    'use strict';

    window.switchTab = function(btn, panelId) {
      var tabs = btn.parentElement.querySelectorAll('.tab');
      tabs.forEach(function(t) { t.classList.remove('active'); t.setAttribute('aria-selected','false'); });
      var panels = btn.closest('.tabs-container').querySelectorAll('.tab-content');
      panels.forEach(function(p) { p.classList.remove('active'); });
      btn.classList.add('active'); btn.setAttribute('aria-selected','true');
      document.getElementById(panelId).classList.add('active');
    };
    window.toggleAccordion = function(btn) {
      var item = btn.parentElement; var isOpen = item.classList.contains('open');
      item.parentElement.querySelectorAll('.accordion-item').forEach(function(s) { s.classList.remove('open'); s.querySelector('.accordion-header').setAttribute('aria-expanded','false'); });
      if (!isOpen) { item.classList.add('open'); btn.setAttribute('aria-expanded','true'); }
    };
    window.toggleReveal = function(trigger) {
      var content = trigger.nextElementSibling;
      content.classList.toggle('visible');
      trigger.setAttribute('aria-expanded', content.classList.contains('visible'));
    };

    var scorm = new SCORMWrapper(); scorm.initialize();
    var cs = scorm.getValue('cmi.core.lesson_status');
    if (!cs || cs === 'not attempted') scorm.setValue('cmi.core.lesson_status', 'incomplete');

    var sounds = new SoundEffects(); var confetti = new Confetti();
    var startTime = new Date(); var points = 0;
    var pointsDisplay = document.getElementById('pointsDisplay');
    var pointsBadge = document.getElementById('pointsBadge');

    try { var s = scorm.getValue('cmi.suspend_data'); if (s) { var p = JSON.parse(s); if (p.points) { points = p.points; pointsDisplay.textContent = points; } } } catch(e) {}

    function awardPoints(n) { points += n; pointsDisplay.textContent = points; pointsBadge.classList.add('glow'); setTimeout(function() { pointsBadge.classList.remove('glow'); }, 600); }

    var kcAnswers = { kc1: 'b', kc2: 'b', kc3: 'false' };
    var kcAnswered = {};
    window.answerKC = function(id, btn, sel) {
      if (kcAnswered[id]) return; kcAnswered[id] = true;
      var isCorrect = sel === kcAnswers[id];
      document.querySelectorAll('#' + id + '-options .btn-quiz-option').forEach(function(o) { o.disabled = true; });
      btn.classList.add(isCorrect ? 'correct' : 'incorrect');
      if (!isCorrect) document.querySelectorAll('#' + id + '-options .btn-quiz-option').forEach(function(o) { if (o.getAttribute('data-id') === kcAnswers[id]) o.classList.add('correct'); });
      var fb = document.getElementById(id + '-feedback'); fb.classList.remove('hidden');
      if (isCorrect) { awardPoints(5); sounds.playSound('success'); fb.className = 'feedback-correct'; fb.innerHTML = '<span>&#10004;</span><div>أحسنت! إجابة صحيحة.</div>'; }
      else { sounds.playSound('error'); fb.className = 'feedback-incorrect'; fb.innerHTML = '<span>&#128161;</span><div>ليس بعد — أنت تتعلم!</div>'; }
    };

    var slideController = new SlideController({
      onSlideChange: function() { sounds.playSound('whoosh'); },
      onComplete: function() {
        awardPoints(15); sounds.playSound('celebration'); confetti.fire();
        scorm.setValue('cmi.core.lesson_status', 'completed');
        var d = Math.floor((new Date() - startTime)/1000);
        var h=Math.floor(d/3600),m=Math.floor((d%3600)/60),s=d%60;
        scorm.setValue('cmi.core.session_time',(h<10?'0':'')+h+':'+(m<10?'0':'')+m+':'+(s<10?'0':'')+s);
        try { scorm.setValue('cmi.suspend_data',JSON.stringify({points:points,completed:true})); } catch(e) {}
        scorm.commit();
      }
    });

    var bk = scorm.getValue('cmi.core.lesson_location');
    if (bk) { var sv = parseInt(bk,10); if (!isNaN(sv) && sv > 0) slideController.resumeFrom(sv); }
    window.addEventListener('beforeunload', function() { scorm.setValue('cmi.core.lesson_location', String(slideController.currentIndex)); scorm.commit(); });
  })();
  </script>
</body>
</html>
