<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>الأنشطة التفاعلية | الذهنية الرقمية وممارسات الابتكار التقني</title>
  <link rel="stylesheet" href="../shared/base.css">
  <link rel="stylesheet" href="../shared/theme.css">
  <link rel="stylesheet" href="../shared/course-custom.css">
</head>
<body>
  <a href="#main-content" class="skip-nav">تخطي إلى المحتوى الرئيسي</a>

  <div class="sco-container">
    <header class="nav-bar">
      <span class="course-title">الأنشطة التفاعلية</span>
      <div class="points-badge elastic-click" id="pointsBadge" aria-label="النقاط">
        <span>&#11088;</span>
        <span class="points-count" id="pointsDisplay">0</span>
      </div>
    </header>
    <div class="progress-bar" role="progressbar"><div class="progress-fill" id="progressFill"></div></div>

    <main class="sco-content" id="main-content">

      <!-- Slide 0: Intro -->
      <div class="slide" data-slide="0">
        <div class="slide-inner">
          <div class="hero-section has-grain text-center stagger-item">
            <h1 class="display-text" style="color:white;">الأنشطة التفاعلية</h1>
            <p style="color:rgba(255,255,255,0.9);">حان وقت تطبيق ما تعلمته!</p>
          </div>
          <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:16px; margin-top:20px;">
            <div class="card shadow-sm stagger-item text-center">
              <h4>النشاط 1</h4>
              <p class="text-small">ترتيب مراحل التفكير التصميمي</p>
            </div>
            <div class="card shadow-sm stagger-item text-center">
              <h4>النشاط 2</h4>
              <p class="text-small">سيناريو ملاءمة السوق</p>
            </div>
            <div class="card shadow-sm stagger-item text-center">
              <h4>النشاط 3</h4>
              <p class="text-small">تصنيف العقلية الريادية</p>
            </div>
          </div>
        </div>
      </div>

      <!-- ACTIVITY 1: Design Thinking Sort -->

      <!-- Slide 1: A1 Instructions -->
      <div class="slide" data-slide="1">
        <div class="slide-inner">
          <h2 class="stagger-item">النشاط 1: ترتيب مراحل التفكير التصميمي</h2>
          <div class="callout callout-info stagger-item" style="max-width:600px; margin:16px auto;">
            <span class="callout-icon" aria-hidden="true">&#128221;</span>
            <div>
              <p><strong>المطلوب:</strong> رتّب المراحل الخمس بالترتيب الصحيح من الأولى إلى الأخيرة باستخدام الأسهم.</p>
              <p style="margin-top:8px;"><strong>النقاط:</strong> 10 نقاط للترتيب الصحيح.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Slide 2: A1 Sort -->
      <div class="slide" data-slide="2">
        <div class="slide-inner align-top">
          <div class="quiz-container">
            <h3 class="question-stem stagger-item">رتّب المراحل بالترتيب الصحيح:</h3>
            <div id="a1SortArea" class="stagger-item" style="display:flex; flex-direction:column; gap:8px; margin-top:16px; max-width:500px; margin-left:auto; margin-right:auto;">
              <div class="drag-item elastic-click" data-id="dt_4" style="display:flex; justify-content:space-between; align-items:center;">
                <span>النموذج الأولي <span class="ltr-inline">(Prototype)</span></span>
                <span style="display:flex; gap:4px;">
                  <button class="btn-ghost" onclick="moveItem(this.closest('.drag-item'),-1,'a1SortArea')" aria-label="لأعلى">&#9650;</button>
                  <button class="btn-ghost" onclick="moveItem(this.closest('.drag-item'),1,'a1SortArea')" aria-label="لأسفل">&#9660;</button>
                </span>
              </div>
              <div class="drag-item elastic-click" data-id="dt_2" style="display:flex; justify-content:space-between; align-items:center;">
                <span>التحديد <span class="ltr-inline">(Define)</span></span>
                <span style="display:flex; gap:4px;">
                  <button class="btn-ghost" onclick="moveItem(this.closest('.drag-item'),-1,'a1SortArea')" aria-label="لأعلى">&#9650;</button>
                  <button class="btn-ghost" onclick="moveItem(this.closest('.drag-item'),1,'a1SortArea')" aria-label="لأسفل">&#9660;</button>
                </span>
              </div>
              <div class="drag-item elastic-click" data-id="dt_5" style="display:flex; justify-content:space-between; align-items:center;">
                <span>الاختبار <span class="ltr-inline">(Test)</span></span>
                <span style="display:flex; gap:4px;">
                  <button class="btn-ghost" onclick="moveItem(this.closest('.drag-item'),-1,'a1SortArea')" aria-label="لأعلى">&#9650;</button>
                  <button class="btn-ghost" onclick="moveItem(this.closest('.drag-item'),1,'a1SortArea')" aria-label="لأسفل">&#9660;</button>
                </span>
              </div>
              <div class="drag-item elastic-click" data-id="dt_1" style="display:flex; justify-content:space-between; align-items:center;">
                <span>التعاطف <span class="ltr-inline">(Empathize)</span></span>
                <span style="display:flex; gap:4px;">
                  <button class="btn-ghost" onclick="moveItem(this.closest('.drag-item'),-1,'a1SortArea')" aria-label="لأعلى">&#9650;</button>
                  <button class="btn-ghost" onclick="moveItem(this.closest('.drag-item'),1,'a1SortArea')" aria-label="لأسفل">&#9660;</button>
                </span>
              </div>
              <div class="drag-item elastic-click" data-id="dt_3" style="display:flex; justify-content:space-between; align-items:center;">
                <span>التفكير <span class="ltr-inline">(Ideate)</span></span>
                <span style="display:flex; gap:4px;">
                  <button class="btn-ghost" onclick="moveItem(this.closest('.drag-item'),-1,'a1SortArea')" aria-label="لأعلى">&#9650;</button>
                  <button class="btn-ghost" onclick="moveItem(this.closest('.drag-item'),1,'a1SortArea')" aria-label="لأسفل">&#9660;</button>
                </span>
              </div>
            </div>
            <button class="btn-primary elastic-click" id="checkA1Btn" onclick="checkActivity1()" style="margin-top:16px;">تحقق من الترتيب</button>
            <div id="a1-feedback" class="hidden" style="margin-top:16px;"></div>
          </div>
        </div>
      </div>

      <!-- ACTIVITY 2: Market Fit Scenario -->

      <!-- Slide 3: A2 Scenario -->
      <div class="slide" data-slide="3">
        <div class="slide-inner align-top">
          <h2 class="stagger-item">النشاط 2: سيناريو ملاءمة السوق</h2>
          <div class="scenario-card stagger-item">
            <h4>&#128100; تطبيق «صحّتي الجامعية»</h4>
            <p>أحمد طالب في كلية علوم الحاسب بجامعة نجران. لاحظ أن زملاءه يعانون من صعوبة حجز مواعيد في العيادة الصحية. قرر تطوير تطبيق «صحّتي الجامعية» يتيح: حجز مواعيد إلكترونيًا، عرض أوقات الذروة، إرسال تذكيرات، وتقييم الخدمة.</p>
            <p style="margin-top:12px;"><strong>نتائج استطلاع 200 طالب:</strong></p>
            <div style="display:flex; gap:16px; flex-wrap:wrap; margin-top:8px;">
              <span class="badge-earned">78% صعوبة في الحجز</span>
              <span class="badge-earned">65% يفضلون الجوال</span>
              <span class="badge-earned">45% يريدون أوقات الذروة</span>
              <span class="badge-earned">30% مهتمون بالتقييم</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Slide 4: A2 Q1 -->
      <div class="slide" data-slide="4">
        <div class="slide-inner">
          <div class="quiz-container">
            <p class="quiz-progress">سؤال السيناريو 1 من 4</p>
            <h3 class="question-stem stagger-item">بناءً على بيانات الاستطلاع، من هي الفئة المستهدفة الأساسية لتطبيق «صحّتي الجامعية»؟</h3>
            <div id="a2q1-options">
              <button class="btn-quiz-option elastic-click stagger-item" data-id="a" onclick="answerScenario('a2q1',this,'a')">جميع سكان مدينة نجران</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="b" onclick="answerScenario('a2q1',this,'b')">طلاب جامعة نجران الذين يستخدمون العيادة ويفضلون الحجز عبر الجوال</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="c" onclick="answerScenario('a2q1',this,'c')">الأطباء العاملون في العيادة</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="d" onclick="answerScenario('a2q1',this,'d')">شركات التأمين الصحي</button>
            </div>
            <div id="a2q1-feedback" class="hidden" style="margin-top:16px;"></div>
          </div>
        </div>
      </div>

      <!-- Slide 5: A2 Q2 -->
      <div class="slide" data-slide="5">
        <div class="slide-inner">
          <div class="quiz-container">
            <p class="quiz-progress">سؤال السيناريو 2 من 4</p>
            <h3 class="question-stem stagger-item">أحمد يريد اختبار فكرة التطبيق بسرعة وبأقل تكلفة. ما نوع النموذج الأولي الأنسب؟</h3>
            <div id="a2q2-options">
              <button class="btn-quiz-option elastic-click stagger-item" data-id="a" onclick="answerScenario('a2q2',this,'a')">نموذج ورقي — رسم الشاشات على ورق واختبارها مع زملائه</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="b" onclick="answerScenario('a2q2',this,'b')">تطبيق مبرمج بالكامل جاهز للنشر</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="c" onclick="answerScenario('a2q2',this,'c')">نموذج مادي — كشك إلكتروني في العيادة</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="d" onclick="answerScenario('a2q2',this,'d')">لا يحتاج نموذجًا — يبدأ البرمجة مباشرة</button>
            </div>
            <div id="a2q2-feedback" class="hidden" style="margin-top:16px;"></div>
          </div>
        </div>
      </div>

      <!-- Slide 6: A2 Q3 -->
      <div class="slide" data-slide="6">
        <div class="slide-inner">
          <div class="quiz-container">
            <p class="quiz-progress">سؤال السيناريو 3 من 4</p>
            <h3 class="question-stem stagger-item">أي الميزات تُظهر أقوى مؤشر على ملاءمة السوق <span class="ltr-inline">(Market Fit)</span>؟</h3>
            <div id="a2q3-options">
              <button class="btn-quiz-option elastic-click stagger-item" data-id="a" onclick="answerScenario('a2q3',this,'a')">خاصية تقييم الخدمة (30%)</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="b" onclick="answerScenario('a2q3',this,'b')">خاصية الحجز الإلكتروني (78% مشكلة + 65% جوال)</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="c" onclick="answerScenario('a2q3',this,'c')">جميع الميزات بنفس الأهمية</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="d" onclick="answerScenario('a2q3',this,'d')">خاصية أوقات الذروة فقط</button>
            </div>
            <div id="a2q3-feedback" class="hidden" style="margin-top:16px;"></div>
          </div>
        </div>
      </div>

      <!-- Slide 7: A2 Q4 -->
      <div class="slide" data-slide="7">
        <div class="slide-inner">
          <div class="quiz-container">
            <p class="quiz-progress">سؤال السيناريو 4 من 4</p>
            <h3 class="question-stem stagger-item">أجرى أحمد اختبار <span class="ltr-inline">A/B</span>:<br>النسخة A: شاشة بسيطة بخطوة واحدة (88% إتمام، 30 ثانية)<br>النسخة B: شاشة تفصيلية بثلاث خطوات (62% إتمام، 90 ثانية)<br><br>ما القرار الأنسب؟</h3>
            <div id="a2q4-options">
              <button class="btn-quiz-option elastic-click stagger-item" data-id="a" onclick="answerScenario('a2q4',this,'a')">النسخة B لأنها أكثر تفصيلًا</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="b" onclick="answerScenario('a2q4',this,'b')">النسخة A لأنها حققت 88% إتمام في وقت أقصر</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="c" onclick="answerScenario('a2q4',this,'c')">تجاهل النتائج وتصميم نسخة ثالثة</button>
              <button class="btn-quiz-option elastic-click stagger-item" data-id="d" onclick="answerScenario('a2q4',this,'d')">لا يمكن اتخاذ قرار</button>
            </div>
            <div id="a2q4-feedback" class="hidden" style="margin-top:16px;"></div>
          </div>
        </div>
      </div>

      <!-- ACTIVITY 3: Mindset Classification -->

      <!-- Slide 8: A3 Instructions -->
      <div class="slide" data-slide="8">
        <div class="slide-inner">
          <h2 class="stagger-item">النشاط 3: تصنيف سلوكيات العقلية الريادية</h2>
          <div class="callout callout-info stagger-item" style="max-width:600px; margin:16px auto;">
            <span class="callout-icon" aria-hidden="true">&#128221;</span>
            <div>
              <p><strong>المطلوب:</strong> لكل سلوك، حدد: هل يدعم العقلية الريادية أم يعيقها؟</p>
              <p style="margin-top:8px;"><strong>النقاط:</strong> 2 نقاط لكل تصنيف صحيح (24 نقطة كحد أقصى).</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Slide 9: A3 Classification -->
      <div class="slide" data-slide="9">
        <div class="slide-inner align-top">
          <div class="quiz-container" style="max-width:800px;">
            <h3 class="question-stem stagger-item">صنّف كل سلوك: يدعم أم يعيق العقلية الريادية؟</h3>
            <div id="classifyItems" class="stagger-item" style="display:grid; gap:8px; margin-top:12px;"></div>
            <button class="btn-primary elastic-click" id="checkA3Btn" onclick="checkActivity3()" style="margin-top:16px;">تحقق من التصنيف</button>
            <div id="a3-feedback" class="hidden" style="margin-top:16px;"></div>
          </div>
        </div>
      </div>

      <!-- Slide 10: Completion -->
      <div class="slide" data-slide="10">
        <div class="slide-inner">
          <div class="text-center">
            <h2 class="stagger-item">أكملت جميع الأنشطة!</h2>
            <p class="stagger-item" id="totalScore" style="font-size:1.2rem; font-weight:600; margin:16px 0;"></p>
            <div class="badge-earned stagger-item" style="margin-top:12px;">&#127942; مبتكر متمرس</div>
            <div class="callout callout-success stagger-item" style="max-width:500px; margin:20px auto;">
              <span class="callout-icon" aria-hidden="true">&#127775;</span>
              <div><strong>أحسنت!</strong> جاهز الآن للاختبار البعدي لقياس تقدمك الكامل.</div>
            </div>
          </div>
        </div>
      </div>

    </main>

    <nav class="sco-nav" aria-label="تنقل">
      <button class="btn-prev elastic-click" id="prevBtn" disabled>السابق</button>
      <span class="page-indicator" id="pageIndicator">1 / 11</span>
      <button class="btn-next elastic-click" id="nextBtn" data-next-text="التالي" data-complete-text="إكمال">التالي</button>
    </nav>
  </div>

  <script src="../shared/scorm-api.js"></script>
  <script src="../shared/engine/slide-controller.js"></script>
  <script src="../shared/engine/sound-effects.js"></script>
  <script src="../shared/engine/confetti.js"></script>
  <script src="../shared/behavior-tracker.js"></script>
  <script src="../shared/gamification.js"></script>

  <script>
  (function() {
    'use strict';

    var scorm = new SCORMWrapper(); scorm.initialize();
    var cs = scorm.getValue('cmi.core.lesson_status');
    if (!cs || cs === 'not attempted') scorm.setValue('cmi.core.lesson_status', 'incomplete');

    var sounds = new SoundEffects(); var confetti = new Confetti();
    var startTime = new Date(); var points = 0; var interactionIdx = 0;
    var pointsDisplay = document.getElementById('pointsDisplay');
    var pointsBadge = document.getElementById('pointsBadge');

    function awardPoints(n) { points += n; pointsDisplay.textContent = points; pointsBadge.classList.add('glow'); setTimeout(function() { pointsBadge.classList.remove('glow'); }, 600); }

    // --- Activity 1: Sort ---
    window.moveItem = function(item, dir, containerId) {
      var parent = document.getElementById(containerId);
      if (dir === -1 && item.previousElementSibling) { parent.insertBefore(item, item.previousElementSibling); sounds.playSound('pop'); }
      else if (dir === 1 && item.nextElementSibling) { parent.insertBefore(item.nextElementSibling, item); sounds.playSound('pop'); }
    };

    var a1Checked = false;
    window.checkActivity1 = function() {
      if (a1Checked) return; a1Checked = true;
      var items = document.querySelectorAll('#a1SortArea .drag-item');
      var correct = ['dt_1','dt_2','dt_3','dt_4','dt_5'];
      var allCorrect = true;
      items.forEach(function(item, i) {
        if (item.getAttribute('data-id') === correct[i]) { item.style.borderColor = 'var(--color-success)'; item.style.background = 'var(--color-success-bg)'; }
        else { item.style.borderColor = 'var(--color-error)'; item.style.background = 'var(--color-error-bg)'; allCorrect = false; }
      });
      document.getElementById('checkA1Btn').disabled = true;
      var fb = document.getElementById('a1-feedback'); fb.classList.remove('hidden');
      if (allCorrect) {
        awardPoints(10); sounds.playSound('success'); confetti.fire();
        fb.className = 'feedback-correct'; fb.innerHTML = '<span>&#10004;</span><div>ممتاز! ترتيب صحيح: تعاطف &#8594; تحديد &#8594; تفكير &#8594; نموذج أولي &#8594; اختبار.</div>';
      } else {
        sounds.playSound('error'); fb.className = 'feedback-incorrect';
        fb.innerHTML = '<span>&#128161;</span><div>ليس بعد! الترتيب: تعاطف &#8594; تحديد &#8594; تفكير &#8594; نموذج أولي &#8594; اختبار.</div>';
      }
      // SCORM interaction
      var userSeq = []; items.forEach(function(it) { userSeq.push(it.getAttribute('data-id')); });
      try {
        scorm.setValue('cmi.interactions.'+interactionIdx+'.id', 'act1_sort');
        scorm.setValue('cmi.interactions.'+interactionIdx+'.type', 'sequencing');
        scorm.setValue('cmi.interactions.'+interactionIdx+'.student_response', userSeq.join(','));
        scorm.setValue('cmi.interactions.'+interactionIdx+'.correct_responses.0.pattern', correct.join(','));
        scorm.setValue('cmi.interactions.'+interactionIdx+'.result', allCorrect ? 'correct' : 'wrong');
        interactionIdx++; scorm.commit();
      } catch(e) {}
    };

    // --- Activity 2: Scenario MCQ ---
    var scenarioAnswers = { a2q1:'b', a2q2:'a', a2q3:'b', a2q4:'b' };
    var scenarioAnswered = {}; var scenarioCorrect = 0;
    window.answerScenario = function(qId, btn, sel) {
      if (scenarioAnswered[qId]) return; scenarioAnswered[qId] = true;
      var isCorrect = sel === scenarioAnswers[qId];
      if (isCorrect) scenarioCorrect++;
      document.querySelectorAll('#'+qId+'-options .btn-quiz-option').forEach(function(o) { o.disabled = true; });
      btn.classList.add(isCorrect ? 'correct' : 'incorrect');
      if (!isCorrect) document.querySelectorAll('#'+qId+'-options .btn-quiz-option').forEach(function(o) { if (o.getAttribute('data-id') === scenarioAnswers[qId]) o.classList.add('correct'); });
      var fb = document.getElementById(qId+'-feedback'); fb.classList.remove('hidden');
      if (isCorrect) { awardPoints(5); sounds.playSound('success'); fb.className = 'feedback-correct'; fb.innerHTML = '<span>&#10004;</span><div>أحسنت! إجابة صحيحة.</div>'; }
      else { sounds.playSound('error'); fb.className = 'feedback-incorrect'; fb.innerHTML = '<span>&#128161;</span><div>ليس بعد — أنت تتعلم!</div>'; }
      try {
        scorm.setValue('cmi.interactions.'+interactionIdx+'.id', qId);
        scorm.setValue('cmi.interactions.'+interactionIdx+'.type', 'choice');
        scorm.setValue('cmi.interactions.'+interactionIdx+'.student_response', sel);
        scorm.setValue('cmi.interactions.'+interactionIdx+'.correct_responses.0.pattern', scenarioAnswers[qId]);
        scorm.setValue('cmi.interactions.'+interactionIdx+'.result', isCorrect ? 'correct' : 'wrong');
        interactionIdx++; scorm.commit();
      } catch(e) {}
    };

    // --- Activity 3: Classification ---
    var behaviors = [
      { id:'bh_01', text:'رؤية الفشل كفرصة للتعلم والتحسين', correct:'supports' },
      { id:'bh_02', text:'الخوف من الفشل يمنعني من تجربة أفكار جديدة', correct:'hinders' },
      { id:'bh_03', text:'الانفتاح على التغذية الراجعة وتعديل الخطة بناءً عليها', correct:'supports' },
      { id:'bh_04', text:'مقاومة أي تغيير والتمسك بالطريقة التقليدية', correct:'hinders' },
      { id:'bh_05', text:'البقاء فضولياً والسعي للتحسين المستمر', correct:'supports' },
      { id:'bh_06', text:'العمل بمفردي دون التعاون مع الآخرين', correct:'hinders' },
      { id:'bh_07', text:'استخدام أدوات مثل Lean Startup و BMC لهيكلة الأفكار', correct:'supports' },
      { id:'bh_08', text:'التوقف عن العمل عند أول عقبة تقنية', correct:'hinders' },
      { id:'bh_09', text:'اختبار الأفكار مع المستخدمين قبل الاستثمار الكامل', correct:'supports' },
      { id:'bh_10', text:'الاعتقاد بأن فكرتي مثالية ولا تحتاج تعديل', correct:'hinders' },
      { id:'bh_11', text:'التركيز على حل مشكلات حقيقية يواجهها الناس', correct:'supports' },
      { id:'bh_12', text:'انتظار الظروف المثالية قبل البدء بأي مشروع', correct:'hinders' }
    ];

    // Build classification UI
    var classifyContainer = document.getElementById('classifyItems');
    behaviors.forEach(function(b) {
      var row = document.createElement('div');
      row.style.cssText = 'display:flex; align-items:center; gap:12px; padding:10px; border:1px solid var(--color-border); border-radius:var(--radius-md); background:var(--color-surface-elevated);';
      row.setAttribute('data-id', b.id);
      row.innerHTML = '<span style="flex:1; font-size:15px;">' + b.text + '</span>' +
        '<select data-behavior="' + b.id + '" style="padding:8px; border-radius:6px; border:2px solid var(--color-border); min-width:120px;">' +
        '<option value="">اختر...</option>' +
        '<option value="supports">يدعم &#10003;</option>' +
        '<option value="hinders">يعيق &#10007;</option>' +
        '</select>';
      classifyContainer.appendChild(row);
    });

    var a3Checked = false;
    window.checkActivity3 = function() {
      if (a3Checked) return; a3Checked = true;
      var correctCount = 0;
      behaviors.forEach(function(b) {
        var sel = document.querySelector('[data-behavior="'+b.id+'"]');
        var row = sel.closest('[data-id]');
        if (sel.value === b.correct) {
          correctCount++;
          row.style.borderColor = 'var(--color-success)'; row.style.background = 'var(--color-success-bg)';
        } else {
          row.style.borderColor = 'var(--color-error)'; row.style.background = 'var(--color-error-bg)';
        }
        sel.disabled = true;
      });
      document.getElementById('checkA3Btn').disabled = true;
      awardPoints(correctCount * 2);
      var fb = document.getElementById('a3-feedback'); fb.classList.remove('hidden');
      if (correctCount === 12) {
        sounds.playSound('celebration'); confetti.fire();
        fb.className = 'feedback-correct'; fb.innerHTML = '<span>&#10004;</span><div>ممتاز! صنّفت جميع السلوكيات بشكل صحيح! +' + (correctCount*2) + ' نقطة.</div>';
      } else if (correctCount >= 8) {
        sounds.playSound('success');
        fb.className = 'feedback-correct'; fb.innerHTML = '<span>&#10004;</span><div>أحسنت! ' + correctCount + ' من 12 صحيحة. +' + (correctCount*2) + ' نقطة.</div>';
      } else {
        sounds.playSound('error');
        fb.className = 'feedback-incorrect'; fb.innerHTML = '<span>&#128161;</span><div>جهد جيد! ' + correctCount + ' من 12 صحيحة. راجع مفاهيم العقلية الريادية.</div>';
      }
      // SCORM
      var userResp = []; behaviors.forEach(function(b) { var s = document.querySelector('[data-behavior="'+b.id+'"]'); userResp.push(b.id+'.'+s.value); });
      var correctResp = behaviors.map(function(b) { return b.id+'.'+b.correct; });
      try {
        scorm.setValue('cmi.interactions.'+interactionIdx+'.id', 'act3_classify');
        scorm.setValue('cmi.interactions.'+interactionIdx+'.type', 'matching');
        scorm.setValue('cmi.interactions.'+interactionIdx+'.student_response', userResp.join(','));
        scorm.setValue('cmi.interactions.'+interactionIdx+'.correct_responses.0.pattern', correctResp.join(','));
        scorm.setValue('cmi.interactions.'+interactionIdx+'.result', correctCount === 12 ? 'correct' : 'wrong');
        interactionIdx++; scorm.commit();
      } catch(e) {}
    };

    var slideController = new SlideController({
      onSlideChange: function(index) {
        sounds.playSound('whoosh');
        if (index === 10) {
          document.getElementById('totalScore').textContent = 'مجموع نقاط الأنشطة: ' + points + ' نقطة';
        }
      },
      onComplete: function() {
        sounds.playSound('celebration'); confetti.fire();
        scorm.setValue('cmi.core.lesson_status', 'completed');
        var d = Math.floor((new Date()-startTime)/1000);
        var h=Math.floor(d/3600),m=Math.floor((d%3600)/60),s=d%60;
        scorm.setValue('cmi.core.session_time',(h<10?'0':'')+h+':'+(m<10?'0':'')+m+':'+(s<10?'0':'')+s);
        try { scorm.setValue('cmi.suspend_data',JSON.stringify({points:points})); } catch(e) {}
        scorm.commit();
      }
    });

    var bk = scorm.getValue('cmi.core.lesson_location');
    if (bk) { var sv=parseInt(bk,10); if(!isNaN(sv)&&sv>0) slideController.resumeFrom(sv); }
    window.addEventListener('beforeunload', function() { scorm.setValue('cmi.core.lesson_location',String(slideController.currentIndex)); scorm.commit(); });
  })();
  </script>
</body>
</html>
